<!-- BOTÃO / ORIGEM DO OVERLAY -->
<button
  matIconButton
  cdkOverlayOrigin
  #trigger="cdkOverlayOrigin"
  aria-haspopup="menu"
  [attr.aria-label]="
    unreadCount() > 0 ? 'Abrir notificações. ' + unreadCount() + ' não lidas' : 'Abrir notificações'
  "
  [attr.aria-expanded]="isOpen()"
  (click)="isOpen.set(!isOpen())"
  class="relative flex items-center justify-center cursor-pointer"
>
  <mat-icon aria-hidden="true" [matBadge]="unreadCount()" [matBadgeHidden]="unreadCount() === 0"
    >notifications</mat-icon
  >
</button>

<!-- OVERLAY -->
<ng-template
  cdkConnectedOverlay
  [cdkConnectedOverlayOrigin]="trigger"
  [cdkConnectedOverlayOpen]="isOpen()"
  cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
  [cdkConnectedOverlayOffsetY]="4"
  (keydown.escape)="close()"
>
  <!-- PAINEL -->
  <nav
    role="menu"
    aria-label="Notificações"
    class="flex max-h-[70vh] sm:w-80 flex-col rounded-xl bg-(--mat-sys-surface-container-low) shadow-xl animate-[fadeIn_150ms_ease-out]"
  >
    <!-- HEADER -->
    <header class="flex justify-between items-center px-4 py-3">
      <h2 class="font-semibold">Notificações</h2>
      <button matButton (click)="clearNotifications()">Limpar</button>
    </header>

    <mat-divider></mat-divider>

    <!-- LISTA -->
    <ul class="flex-1 overflow-auto" role="menu">
      @if (notifications().length > 0) {
        @for (item of notifications(); track item.id) {
          <li role="menuitem">
            <div class="flex flex-col px-4 py-3 gap-2.5">
              <div class="flex justify-between items-center">
                <span class="font-medium"> {{ item.title }} </span>
                @if (!item.read) {
                  <span
                    class="inline-flex h-2 w-2 rounded-full bg-(--mat-sys-primary)"
                    role="status"
                    aria-label="Notificação não lida"
                  ></span>
                }
              </div>
              <p>{{ item.description }}</p>
              <span class="text-(--mat-sys-outline) self-end">
                {{ formatNotificationTime(item.timestamp) }}
              </span>
            </div>
          </li>
          <mat-divider></mat-divider>
        }
      } @else {
        <li role="menuitem">
          <div class="flex flex-col px-4 py-3 gap-2.5">
            <p>Você não tem notificações.</p>
          </div>
        </li>
      }
    </ul>
  </nav>
</ng-template>
